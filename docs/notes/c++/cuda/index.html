<!DOCTYPE html>
<html lang="zn-ch" dir="ltr">
<head><script src="/Programming-Notes/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=Programming-Notes/livereload" data-no-instant defer></script>
  <!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="CUDA#本人使用windows&#43;wsl&#43;nix 进行的cuda学习。
配置环境#在自己的windows主机上安装nvidia驱动。nvidia官网 安装WSL 在WSL中安装NIX(最好有代理工具，nix的bincache网站会很慢) 使用nix flake; 向/etc/nix/nix.conf添experimental-features = nix-command flakes clone nix flake template 运行 nix flake -t github:Nazelto/nix.flake-template 这样全局环境就配置好了，接下来配置nix-shell
nix-shell#修改flake.nix 为以下内容
{ description = &#34;flake-utils template&#34;; inputs = { nixpkgs.url = &#34;github:nixos/nixpkgs?ref=nixos-25.11&#34;; flake-utils.url = &#34;github:numtide/flake-utils&#34;; }; outputs = { self, nixpkgs, flake-utils, ... }: flake-utils.lib.eachDefaultSystem ( system: let pkgs = import nixpkgs { inherit system; config.allowUnfree = true; config.cudaSupport = true; }; in { devShells.default = pkgs.mkShell { packages = with pkgs; [ cudaPackages_12.cudatoolkit cudaPackages_12.cudnn xmake ]; shellHook = &#39;&#39; # 导出cudatoolkit export CUDA_PATH=${pkgs.cudaPackages_12.cudatoolkit} export CUDA_HOME=${pkgs.cudaPackages_12.cudatoolkit} export PATH=$CUDA_HOME:$PATH # 去哪里找cuda Driver export LD_LIBRARY_PATH=/usr/lib/wsl/lib:$CUDA_HOME/lib64:$LD_LIBRARY_PATH &#39;&#39;; }; } ); }cudatoolkit与 cuda Driver不是一种东西。
cuda Driver 是 Nvidia驱动中的部分即cuda程序的运行时。
cudatoolkit 是开发工具。
pytorch就是一个例子，它需要安装cudatoolkit 因为他需要编译出cuda程序。
">
<meta name="theme-color" media="(prefers-color-scheme: light)" content="#ffffff">
<meta name="theme-color" media="(prefers-color-scheme: dark)" content="#343a40">
<meta name="color-scheme" content="light dark"><meta property="og:url" content="http://localhost:1313/Programming-Notes/docs/notes/c&#43;&#43;/cuda/">
  <meta property="og:site_name" content="Nazeltoの编程随记">
  <meta property="og:title" content="Nazeltoの编程随记">
  <meta property="og:description" content="CUDA#本人使用windows&#43;wsl&#43;nix 进行的cuda学习。
配置环境#在自己的windows主机上安装nvidia驱动。nvidia官网 安装WSL 在WSL中安装NIX(最好有代理工具，nix的bincache网站会很慢) 使用nix flake; 向/etc/nix/nix.conf添experimental-features = nix-command flakes clone nix flake template 运行 nix flake -t github:Nazelto/nix.flake-template 这样全局环境就配置好了，接下来配置nix-shell
nix-shell#修改flake.nix 为以下内容
{ description = &#34;flake-utils template&#34;; inputs = { nixpkgs.url = &#34;github:nixos/nixpkgs?ref=nixos-25.11&#34;; flake-utils.url = &#34;github:numtide/flake-utils&#34;; }; outputs = { self, nixpkgs, flake-utils, ... }: flake-utils.lib.eachDefaultSystem ( system: let pkgs = import nixpkgs { inherit system; config.allowUnfree = true; config.cudaSupport = true; }; in { devShells.default = pkgs.mkShell { packages = with pkgs; [ cudaPackages_12.cudatoolkit cudaPackages_12.cudnn xmake ]; shellHook = &#39;&#39; # 导出cudatoolkit export CUDA_PATH=${pkgs.cudaPackages_12.cudatoolkit} export CUDA_HOME=${pkgs.cudaPackages_12.cudatoolkit} export PATH=$CUDA_HOME:$PATH # 去哪里找cuda Driver export LD_LIBRARY_PATH=/usr/lib/wsl/lib:$CUDA_HOME/lib64:$LD_LIBRARY_PATH &#39;&#39;; }; } ); }cudatoolkit与 cuda Driver不是一种东西。
cuda Driver 是 Nvidia驱动中的部分即cuda程序的运行时。
cudatoolkit 是开发工具。
pytorch就是一个例子，它需要安装cudatoolkit 因为他需要编译出cuda程序。">
  <meta property="og:locale" content="zn_ch">
  <meta property="og:type" content="article">
    <meta property="article:section" content="docs">


  <meta itemprop="name" content="Nazeltoの编程随记">
  <meta itemprop="description" content="CUDA#本人使用windows&#43;wsl&#43;nix 进行的cuda学习。
配置环境#在自己的windows主机上安装nvidia驱动。nvidia官网 安装WSL 在WSL中安装NIX(最好有代理工具，nix的bincache网站会很慢) 使用nix flake; 向/etc/nix/nix.conf添experimental-features = nix-command flakes clone nix flake template 运行 nix flake -t github:Nazelto/nix.flake-template 这样全局环境就配置好了，接下来配置nix-shell
nix-shell#修改flake.nix 为以下内容
{ description = &#34;flake-utils template&#34;; inputs = { nixpkgs.url = &#34;github:nixos/nixpkgs?ref=nixos-25.11&#34;; flake-utils.url = &#34;github:numtide/flake-utils&#34;; }; outputs = { self, nixpkgs, flake-utils, ... }: flake-utils.lib.eachDefaultSystem ( system: let pkgs = import nixpkgs { inherit system; config.allowUnfree = true; config.cudaSupport = true; }; in { devShells.default = pkgs.mkShell { packages = with pkgs; [ cudaPackages_12.cudatoolkit cudaPackages_12.cudnn xmake ]; shellHook = &#39;&#39; # 导出cudatoolkit export CUDA_PATH=${pkgs.cudaPackages_12.cudatoolkit} export CUDA_HOME=${pkgs.cudaPackages_12.cudatoolkit} export PATH=$CUDA_HOME:$PATH # 去哪里找cuda Driver export LD_LIBRARY_PATH=/usr/lib/wsl/lib:$CUDA_HOME/lib64:$LD_LIBRARY_PATH &#39;&#39;; }; } ); }cudatoolkit与 cuda Driver不是一种东西。
cuda Driver 是 Nvidia驱动中的部分即cuda程序的运行时。
cudatoolkit 是开发工具。
pytorch就是一个例子，它需要安装cudatoolkit 因为他需要编译出cuda程序。">
  <meta itemprop="wordCount" content="249">

<title>Cuda | Nazeltoの编程随记</title>
<link rel="icon" href="/Programming-Notes/favicon.png" >
<link rel="manifest" href="/Programming-Notes/manifest.json">
<link rel="canonical" href="http://localhost:1313/Programming-Notes/docs/notes/c&#43;&#43;/cuda/">
<link rel="stylesheet" href="/Programming-Notes/book.min.6970156cec683193d93c9c4edaf0d56574e4361df2e0c1be4f697ae81c3ba55f.css" integrity="sha256-aXAVbOxoMZPZPJxO2vDVZXTkNh3y4MG&#43;T2l66Bw7pV8=" crossorigin="anonymous">


  <script defer src="/Programming-Notes/fuse.min.js"></script>
  <script defer src="/Programming-Notes/en.search.min.19c452d808cf4d39c33c0175cb5002e34a8d43afe26037762177203a9c988223.js" integrity="sha256-GcRS2AjPTTnDPAF1y1AC40qNQ6/iYDd2IXcgOpyYgiM=" crossorigin="anonymous"></script>



  
</head>
<body dir="ltr" class="book-kind-page book-type-docs">
  <input type="checkbox" class="hidden toggle" id="menu-control" />
  <input type="checkbox" class="hidden toggle" id="toc-control" />
  <main class="container flex">
    
<aside class="book-menu">
  <div class="book-menu-content">
    
  <nav>
<h2 class="book-brand">
  <a class="flex align-center" href="/Programming-Notes/"><span>Nazeltoの编程随记</span>
  </a>
</h2>


<div class="book-search hidden">
  <input id="book-search-input" type="text" 
    placeholder="Search"
    aria-label="Search"
    maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>
<script>document.querySelector(".book-search").classList.remove("hidden")</script>













  
  <ul>
    
      
        <li class="book-section-flat" >
          
  
  

  
    <a href="/Programming-Notes/docs/notes/" class="">
      Introduction</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-b0c009d8e04ed4f3e4b607bcb99eff24" class="toggle"  />
    <label for="section-b0c009d8e04ed4f3e4b607bcb99eff24" class="flex">
      <a href="/Programming-Notes/docs/notes/python/" class="">
        Python</a>
      <img src="/Programming-Notes/icons/chevron-right.svg" class="book-icon" alt="Expand" />
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/Programming-Notes/docs/notes/python/functional_py/" class="">
      Functional Py</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/Programming-Notes/docs/notes/python/itertools/" class="">
      Itertools</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/Programming-Notes/docs/notes/python/modern_python/" class="">
      Modern Python</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-7b7ba33566a4bb9cee04ebe046f31a19" class="toggle"  />
    <label for="section-7b7ba33566a4bb9cee04ebe046f31a19" class="flex">
      <a href="/Programming-Notes/docs/notes/zig/" class="">
        Zig</a>
      <img src="/Programming-Notes/icons/chevron-right.svg" class="book-icon" alt="Expand" />
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/Programming-Notes/docs/notes/zig/zig-grammar/" class="">
      Zig Grammar</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-6d87527d98c3e3fb63eee838a8bbea11" class="toggle" checked />
    <label for="section-6d87527d98c3e3fb63eee838a8bbea11" class="flex">
      <a href="/Programming-Notes/docs/notes/c&#43;&#43;/" class="">
        C&#43;&#43;</a>
      <img src="/Programming-Notes/icons/chevron-right.svg" class="book-icon" alt="Expand" />
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/Programming-Notes/docs/notes/c&#43;&#43;/coroutine/" class="">
      Coroutine</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/Programming-Notes/docs/notes/c&#43;&#43;/cpp_export_macros/" class="">
      Cpp Export Macros</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/Programming-Notes/docs/notes/c&#43;&#43;/crtp/" class="">
      Crtp</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/Programming-Notes/docs/notes/c&#43;&#43;/cuda/" class="active">
      Cuda</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/Programming-Notes/docs/notes/c&#43;&#43;/extern/" class="">
      Extern</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/Programming-Notes/docs/notes/c&#43;&#43;/ftl/" class="">
      Ftl</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-dc456b687142a9e10cb3f8aed083df22" class="toggle"  />
    <label for="section-dc456b687142a9e10cb3f8aed083df22" class="flex">
      <a href="/Programming-Notes/docs/notes/nix/" class="">
        Nix</a>
      <img src="/Programming-Notes/icons/chevron-right.svg" class="book-icon" alt="Expand" />
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/Programming-Notes/docs/notes/nix/flake_parts/" class="">
      Flake Parts</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-fb6aca9a5328c1176bf64374f8ad4b13" class="toggle"  />
    <label for="section-fb6aca9a5328c1176bf64374f8ad4b13" class="flex">
      <a href="/Programming-Notes/docs/notes/rust/" class="">
        Rust</a>
      <img src="/Programming-Notes/icons/chevron-right.svg" class="book-icon" alt="Expand" />
    </label>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/Programming-Notes/docs/notes/rust/rust_algorithm/" class="">
      Rust Algorithm</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/Programming-Notes/docs/notes/rust/rust_algorithm/dp/" class="">
      Dp</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <input type="checkbox" id="section-9bf5a1677816b6db3cc4d811115e9580" class="toggle"  />
    <label for="section-9bf5a1677816b6db3cc4d811115e9580" class="flex">
      <a href="/Programming-Notes/docs/notes/rust/crate/" class="">
        Rust Crate</a>
      <img src="/Programming-Notes/icons/chevron-right.svg" class="book-icon" alt="Expand" />
    </label>
  

          
  <ul>
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/Programming-Notes/docs/notes/rust/cuda/" class="">
      Cuda</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/Programming-Notes/docs/notes/rust/lifetime/" class="">
      Lifetime</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/Programming-Notes/docs/notes/rust/rust_iterator_adapters/" class="">
      Rust Iterator Adapters</a>
  

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/Programming-Notes/docs/notes/rust/%E5%86%85%E9%83%A8%E5%8F%AF%E5%8F%98%E6%80%A7/" class="">
      内部可变性</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/Programming-Notes/docs/notes/haskell/" class="">
      Haskell</a>
  

          
  <ul>
    
      
        <li>
          
  
  

  
    <a href="/Programming-Notes/docs/notes/haskell/async/" class="">
      Async</a>
  

        </li>
      
    
  </ul>

        </li>
      
    
      
        <li>
          
  
  

  
    <a href="/Programming-Notes/docs/notes/medical_imaging/" class="">
      Medical Imaging</a>
  

          
  <ul>
    
  </ul>

        </li>
      
    
  </ul>

        </li>
      
    
  </ul>













</nav>




  <script>(function(){var e=document.querySelector("aside .book-menu-content");addEventListener("beforeunload",function(){localStorage.setItem("menu.scrollTop",e.scrollTop)}),e.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>



  </div>
</aside>
 

    <div class="book-page">
      <header class="book-header hidden">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/Programming-Notes/icons/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <h3>Cuda</h3>

  <label for="toc-control">
    
    <img src="/Programming-Notes/icons/toc.svg" class="book-icon" alt="Table of Contents" />
    
  </label>
</div>


  
  <aside class="hidden">
    
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#配置环境">配置环境</a></li>
    <li><a href="#nix-shell">nix-shell</a></li>
    <li><a href="#编写程序">编写程序</a></li>
    <li><a href="#通过rust-ffi调用">通过Rust FFI调用</a></li>
  </ul>
</nav>



  </aside>
  
 
      </header>

      
      
  <article class="markdown book-article"><h1 id="cuda">CUDA<a class="anchor" href="#cuda">#</a></h1>
<p>本人使用windows+wsl+nix 进行的cuda学习。</p>
<h2 id="配置环境">配置环境<a class="anchor" href="#%e9%85%8d%e7%bd%ae%e7%8e%af%e5%a2%83">#</a></h2>
<ol>
<li>在自己的windows主机上安装nvidia驱动。<a href="https://www.nvidia.com/">nvidia官网</a></li>
<li>安装WSL</li>
<li>在WSL中安装NIX(最好有代理工具，nix的bincache网站会很慢)</li>
<li>使用nix flake; 向<code>/etc/nix/nix.conf</code>添<code>experimental-features = nix-command flakes</code></li>
<li>clone nix flake template 运行 <code>nix flake -t github:Nazelto/nix.flake-template</code></li>
</ol>
<p>这样全局环境就配置好了，接下来配置nix-shell</p>
<h2 id="nix-shell">nix-shell<a class="anchor" href="#nix-shell">#</a></h2>
<p>修改flake.nix 为以下内容</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-nix" data-lang="nix"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  description <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;flake-utils template&#34;</span>;
</span></span><span style="display:flex;"><span>  inputs <span style="color:#f92672">=</span> {
</span></span><span style="display:flex;"><span>    nixpkgs<span style="color:#f92672">.</span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;github:nixos/nixpkgs?ref=nixos-25.11&#34;</span>;
</span></span><span style="display:flex;"><span>    flake-utils<span style="color:#f92672">.</span>url <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;github:numtide/flake-utils&#34;</span>;
</span></span><span style="display:flex;"><span>  };
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  outputs <span style="color:#f92672">=</span>
</span></span><span style="display:flex;"><span>    {
</span></span><span style="display:flex;"><span>      self<span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>      nixpkgs<span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>      flake-utils<span style="color:#f92672">,</span>
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">...</span>
</span></span><span style="display:flex;"><span>    }:
</span></span><span style="display:flex;"><span>    flake-utils<span style="color:#f92672">.</span>lib<span style="color:#f92672">.</span>eachDefaultSystem (
</span></span><span style="display:flex;"><span>      system:
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span>
</span></span><span style="display:flex;"><span>        pkgs <span style="color:#f92672">=</span> <span style="color:#f92672">import</span> nixpkgs {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">inherit</span> system;
</span></span><span style="display:flex;"><span>          config<span style="color:#f92672">.</span>allowUnfree <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>          config<span style="color:#f92672">.</span>cudaSupport <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span>;
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">in</span>
</span></span><span style="display:flex;"><span>      {
</span></span><span style="display:flex;"><span>        devShells<span style="color:#f92672">.</span>default <span style="color:#f92672">=</span> pkgs<span style="color:#f92672">.</span>mkShell {
</span></span><span style="display:flex;"><span>          packages <span style="color:#f92672">=</span> <span style="color:#66d9ef">with</span> pkgs; [
</span></span><span style="display:flex;"><span>            cudaPackages_12<span style="color:#f92672">.</span>cudatoolkit
</span></span><span style="display:flex;"><span>            cudaPackages_12<span style="color:#f92672">.</span>cudnn
</span></span><span style="display:flex;"><span>            xmake
</span></span><span style="display:flex;"><span>          ];
</span></span><span style="display:flex;"><span>          shellHook <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;&#39;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            # 导出cudatoolkit
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            export CUDA_PATH=</span><span style="color:#e6db74">${</span>pkgs<span style="color:#f92672">.</span>cudaPackages_12<span style="color:#f92672">.</span>cudatoolkit<span style="color:#e6db74">}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            export CUDA_HOME=</span><span style="color:#e6db74">${</span>pkgs<span style="color:#f92672">.</span>cudaPackages_12<span style="color:#f92672">.</span>cudatoolkit<span style="color:#e6db74">}</span><span style="color:#e6db74">
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            export PATH=$CUDA_HOME:$PATH
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            # 去哪里找cuda Driver
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            export LD_LIBRARY_PATH=/usr/lib/wsl/lib:$CUDA_HOME/lib64:$LD_LIBRARY_PATH
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          &#39;&#39;</span>;
</span></span><span style="display:flex;"><span>        };
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    );
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><blockquote class='book-hint note'>
<p>cudatoolkit与 cuda Driver不是一种东西。<br>
cuda Driver 是 Nvidia驱动中的部分即cuda程序的运行时。<br>
cudatoolkit 是开发工具。<br>
pytorch就是一个例子，它需要安装cudatoolkit 因为他需要编译出cuda程序。</p></blockquote><h2 id="编写程序">编写程序<a class="anchor" href="#%e7%bc%96%e5%86%99%e7%a8%8b%e5%ba%8f">#</a></h2>
<p>使用<code>nix develop</code>进入nix-shell</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span><span style="color:#75715e"># 运行下列命令创建cuda项目</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># 这是创建一个cuda的动态库</span>
</span></span><span style="display:flex;"><span>xmake -l cuda -t shared try_cuda </span></span></code></pre></div><p>最终的目录结构</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-shell" data-lang="shell"><span style="display:flex;"><span>|-- try_cuda/
</span></span><span style="display:flex;"><span>|   |-- build/
</span></span><span style="display:flex;"><span>|   |-- inc/
</span></span><span style="display:flex;"><span>|   |-- lib/
</span></span><span style="display:flex;"><span>|   |-- src/
</span></span><span style="display:flex;"><span>|   <span style="color:#e6db74">`</span>-- xmake.lua*
</span></span><span style="display:flex;"><span>|-- flake.lock
</span></span><span style="display:flex;"><span><span style="color:#e6db74">`</span>-- flake.nix</span></span></code></pre></div><p>关于c++宏定义内容请看这里 <a href="/Programming-Notes/docs/notes/c&amp;#43;&amp;#43;/cpp_export_macros/">cpp_export_macros</a></p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">//lib.cuh
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//声明函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>__noexport <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">hello</span>(); <span style="color:#75715e">//为了简洁就不写宏定义了 
</span></span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">//lib.cu
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//实现函数
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>__global__ <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">hello_kernal</span>() {
</span></span><span style="display:flex;"><span>  printf(<span style="color:#e6db74">&#34;Hello World from GPU %d</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>, threadIdx.x);
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">hello</span>(){
</span></span><span style="display:flex;"><span>    hello_kernal<span style="color:#f92672">&lt;&lt;&lt;</span><span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">10</span><span style="color:#f92672">&gt;&gt;&gt;</span>();
</span></span><span style="display:flex;"><span>    cudaDeviceSynchronize();
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">//lib.h
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">//声明包裹函数 不对外暴露实现细节
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">helloFromGPU</span>();</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e">//lib.cpp
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;lib.h&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e">#include</span> <span style="color:#75715e">&lt;lib.cuh&gt;</span><span style="color:#75715e">
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">void</span> <span style="color:#a6e22e">helloFromGPU</span>(){
</span></span><span style="display:flex;"><span>    printf(<span style="color:#e6db74">&#34;Hello World from GPU!</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>);
</span></span><span style="display:flex;"><span>    hello();
</span></span><span style="display:flex;"><span>}</span></span></code></pre></div><p>通过<code>xmake build</code>编译为库并使用<code>xmake install</code>安装</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-lua" data-lang="lua"><span style="display:flex;"><span><span style="color:#75715e">-- xmake.lua</span>
</span></span><span style="display:flex;"><span>add_rules(<span style="color:#e6db74">&#34;mode.debug&#34;</span>, <span style="color:#e6db74">&#34;mode.release&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- 自动生成compile_commands.json 用于lsp</span>
</span></span><span style="display:flex;"><span>add_rules(<span style="color:#e6db74">&#34;plugin.compile_commands.autoupdate&#34;</span>, { outputdir <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;$(builddir)&#34;</span> })
</span></span><span style="display:flex;"><span>target(<span style="color:#e6db74">&#34;mycuda&#34;</span>)
</span></span><span style="display:flex;"><span>set_kind(<span style="color:#e6db74">&#34;shared&#34;</span>)
</span></span><span style="display:flex;"><span>add_files(<span style="color:#e6db74">&#34;src/**.cu&#34;</span>)
</span></span><span style="display:flex;"><span>add_files(<span style="color:#e6db74">&#34;src/**.cpp&#34;</span>)
</span></span><span style="display:flex;"><span>add_includedirs(<span style="color:#e6db74">&#34;inc&#34;</span>, { public <span style="color:#f92672">=</span> <span style="color:#66d9ef">true</span> })
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- 设置build产物目录</span>
</span></span><span style="display:flex;"><span>set_targetdir(<span style="color:#e6db74">&#34;$(projectdir)/lib&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- 与set_installdir有关 如果不设置 默认位置为 /usr/local/lib 安装头文件用于rust bindgen</span>
</span></span><span style="display:flex;"><span>add_installfiles(<span style="color:#e6db74">&#34;inc/*.h&#34;</span>, { prefixdir <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;include/cuda&#34;</span> })
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- 更改install地址为用户库位置</span>
</span></span><span style="display:flex;"><span>set_installdir(<span style="color:#e6db74">&#34;$(env HOME)/.local&#34;</span>)
</span></span><span style="display:flex;"><span><span style="color:#75715e">-- generate SASS code for SM architecture of current host</span>
</span></span><span style="display:flex;"><span>add_cugencodes(<span style="color:#e6db74">&#34;native&#34;</span>)</span></span></code></pre></div><h2 id="通过rust-ffi调用">通过Rust FFI调用<a class="anchor" href="#%e9%80%9a%e8%bf%87rust-ffi%e8%b0%83%e7%94%a8">#</a></h2>
<p><a href="/Programming-Notes/docs/notes/rust/cuda/">Rust 调用</a></p>
</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">

<div>

</div>

<div>

</div>

</div>





  
  
  
  <div class="flex flex-wrap justify-between">
    <span>
    
      <a href="/Programming-Notes/docs/notes/c&#43;&#43;/crtp/" class="flex align-center">
        <img src="/Programming-Notes/icons/backward.svg" class="book-icon" alt="Backward" />
        <span>Crtp</span>
      </a>
    
    </span>
    <span>
    
      <a href="/Programming-Notes/docs/notes/c&#43;&#43;/extern/" class="flex align-center">
        <span>Extern</span>
        <img src="/Programming-Notes/icons/forward.svg" class="book-icon" alt="Forward" />
      </a>
    
    </span>
  </div>
  


 
        
  
  <div class="book-comments">

</div>
  
 
        
        
  
 
        
  
  
    <script>(function(){document.querySelectorAll("pre:has(code)").forEach(e=>{e.addEventListener("click",e.focus),e.addEventListener("copy",function(t){if(t.preventDefault(),navigator.clipboard){const t=window.getSelection().toString()||e.textContent;navigator.clipboard.writeText(t)}})})})()</script>
  

      </footer>

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
  
  <aside class="book-toc">
    <div class="book-toc-content">
      
  
<nav id="TableOfContents">
  <ul>
    <li><a href="#配置环境">配置环境</a></li>
    <li><a href="#nix-shell">nix-shell</a></li>
    <li><a href="#编写程序">编写程序</a></li>
    <li><a href="#通过rust-ffi调用">通过Rust FFI调用</a></li>
  </ul>
</nav>



    </div>
  </aside>
  
 
  </main>

  
</body>
</html>




















